## Конвенции разработки (для code ассистента)

Документ задаёт краткие правила генерации кода. Детали и обоснования — в @vision.md. Здесь фиксируем только то, что влияет на качество и соответствие MVP.

### Технологии и ограничения MVP
- **Python 3.11, aiogram, long polling**: генерировать код под эти версии и подход. Без вебхуков, очередей, фоновых задач. См. @vision.md.
- **LLM-клиент**: единый OpenAI-совместимый клиент с параметрами из `.env` (`LLM_BASE_URL`, `LLM_API_KEY`, `LLM_MODEL`). Без провайдера-специфичных SDK. См. @vision.md.
- **Хранение**: только локальный CSV для лидов. Без БД. См. @vision.md.
- **Развёртывание**: локально, один процесс. Никаких докеров и оркестраторов на MVP. См. @vision.md.

### Архитектура и структура
- Использовать минимальную структуру директорий из @vision.md (`bot/`, `config/`, `doc/`, корневые файлы). Не добавлять новые слои и сервисы без необходимости.
- **Линейный поток обработки**: одна точка входа `bot/main.py`, маршрутизация в `handlers.py`, LLM в `llm_client.py`, промпты в `prompt.py`, хранилище в `lead_store.py`, логи в `logging_conf.py`.
- **Конфиг**: загрузка из `.env` через `python-dotenv` в старте приложения. Критичные переменные обязательны; при отсутствии — остановка с понятным сообщением.

### Код-стайл и качество
- **KISS (Keep It Simple, Stupid)**:
  - Простые решения лучше сложных
  - Минимум кода для достижения цели
  - Понятность важнее "умности"
- **KISS, читаемость > гибкость**: простые функции, ранние выходы, минимальная вложенность, без избыточных абстракций. См. @vision.md.
- **Именование**: говорящие полные слова; функции — глаголы, переменные — существительные; избегать аббревиатур.
- **Типизация**: добавлять аннотации для публичных API и сложных сигнатур; не использовать `Any` без причины.
- **Ошибки**: обрабатывать предсказуемо, возвращать короткие fallback-сообщения, не глушить исключения. См. @vision.md.
- **Логи**: уровень INFO, формат простой/JSON; логируем ключевые события без PII и без ключей. См. @vision.md.
- **Комментарии**: кратко «зачем», не «как»; не дублировать очевидное.
- **Зависимости**: только необходимые для MVP (aiogram, openai-клиент, python-dotenv и пр. из @vision.md). Без утилитарных пакетов, если можно стандартной библиотекой.

### LLM и данные
- **Промпт**: статичный системный промпт и шаблоны в `prompt.py`. Ответы только на русском. См. @vision.md.
- **Контекст**: хранить краткое суммирование диалога; не слать лишние PII провайдеру. См. @vision.md.
- **Безопасность**: не логировать ключи, промпты целиком или персональные данные; секреты — только в `.env` (не коммитить). См. @vision.md.

### Тестирование и проверка
- **Прагматично**: ручные e2e проверки ключевых сценариев + несколько unit-тестов для критичных функций. См. @vision.md.
- **Стабильность > полнота**: покрывать проверки, влияющие на основной сценарий лидогенерации.

### Документация и артефакты
- Источники правды: `README.md` и @vision.md. В коде — только то, что нужно для запуска и понимания.
- Обновлять `requirements.txt` и пример `config/.env.example` при добавлении параметров/пакетов.

### Что НЕ делать на MVP
- Не добавлять БД, брокеры, вебхуки, фоновые задачи, сложный DI/конфиг, метрики и дашборды. См. @vision.md.
- Не расширять API/функциональность сверх сценариев из @vision.md.

### Формат PR/изменений
- Малые, атомарные правки, которые можно проверить вручную за минуты.
- Сообщения коммитов и описания PR — по сути изменения, без воды.


